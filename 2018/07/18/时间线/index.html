<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Liu Yao"><link rel="alternative" href="/atom.xml" title="I am yao" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>JS异步加载和时间线 - I am yao</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">I am yao</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-07-18T13:24:44.000Z">July 18, 2018</time><h1 class="post__title"><a href="/2018/07/18/时间线/">JS异步加载和时间线</a></h1><div class="post__main echo"><p>##JavaScript异步加载的三种方案<br>1、defer异步加载，但要等到DOM文档全部解析完才会被执行。且只有IE能使用，可以将代码写到script内部。<br>2、async异步加载，加载完就执行，async只能加载外部脚本，且不能把代码写到script内部。（1,2执行时不会阻塞页面）<br>3、创建script，插入到DOM中，加载完毕后callback。</p>
<p>##JavaScript加载时间线<br>1、创建Document对象，开始解析web页面。解析HTML元素和他们的文本内容后添加Element对象和Text节点到文档中。这个阶段document.readyState = “loading”.</p>
<p>2、遇到link外部css，创建线程加载并继续解析文档。</p>
<p>3、遇到script外部js，并且没有设置async或者defer属性，则浏览器加载并阻塞，等待js加载完成并执行该脚本，然后继续解析文档。</p>
<p>4、遇到script外部js，并且设置有async或者defer属性，则浏览器创建线程加载，并继续解析文档。对于async属性的脚本，脚本加载完成后立即执行。（异步禁止使用document.write())</p>
<p>5、遇到img等，先正常解析DOM结构，然后浏览器异步加载src，并继续解析文档。</p>
<p>6、当文档解析完成，document.readyState = “interactive”。</p>
<p>7、文档解析完成后，所有设置有defer的脚本会按照顺序执行。（注意与async的不同，但同样禁止使用document.write()）</p>
<p>8、document对象触发DOMContentLoaded事件，这也标志着程序执行从同步脚本执行阶段转化为事件驱动阶段。</p>
<p>9、当所有async的脚本加载完成并执行后，img等加载完成后，document.readyState = “complete” , 此时window对象触发load事件。</p>
<p>10、从此，以异步响应方式处理用户输入，网络等事件。</p>
</div></header></article><div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC8zNzg4Mi8xNDQxMg=="><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2017-2018 Liu Yao</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>